# ah-fs.processor [![build status](https://secure.travis-ci.org/nodesource/ah-fs.processor.png)](http://travis-ci.org/nodesource/ah-fs.processor)

Processes ah-fs data obtained from async resources related to file system opearations.

## Installation

    npm install ah-fs.processor

## [API](https://nodesource.github.io/ah-fs.processor)

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### ReadFileProcessor

Instantiates an fs.readFile data processor to process data collected via
[nodesource/ah-fs](https://github.com/nodesource/ah-fs)

**Parameters**

-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `includeActivities` **[boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** if `true` the actual activities are appended to the output (optional, default `false`)

### readFileProcessor.process

Processes the supplied async activities and splits them into
groups, each representing a file read `fs.readFile`

If no file read was encountered the groups are empty.

All **execution** data contains four timestamps:

-   **triggered** when was this activity triggered from another one, i.e.
    `stat` is triggered by `open` (this timestamp is not available for `open`)
-   **initialized** when was the resource initialized, i.e. its `init` hook fired
-   **completed** when did the async activity complete and gave control back to the
    activity that triggered it (this timestamp is not available for `open`)
-   **destroyed** when was the resource destroyed, i.e. its `destroy` hook fired
    Each group has the following properties:

-   **execution**: information about the execution of the various
    file system operations involved in reading the file
-   **open**: contains data about opening the file
-   **stat**: contains data about getting file stats
-   **read**: contains data about reading the file
-   **close**: contains data about closing the file

-   **calledBy**: provides the line of code that called `fs.readFile` only
    available if stacks were captured
-   **callback**: provides information about the callback that was registered
    for the `fs.readFile` call and has the following properties
    -   **name**: the function name
    -   **location**: the file and line + column where the callback was defined
    -   **arguments**: the `err` and information about the `src` that was
        read. This property is only available _if_ and it's structure depends on
        _how_ arguments were captured.

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** information about `fs.readFile` operations with the
structure outlined above

### ReadFileProcessor.operationSteps

The number of steps involved to execute `fs.readFile`.

This can be used by higher level processors to group
activities looking for larger operations first and then
operations involving less steps.

### utils.idsTriggeredBy

Finds all ids of activities that are triggered by the given id.
This function works recursive, i.e. any activity triggered by
a child of the root activity is included as well.

For this to work, activities are assumed to be in the order that
they were triggered. This can easily be achieved by simply sorting
the activities by their init timestamp.

**Parameters**

-   `activities` **[Map](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map)&lt;[number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number), Activity>** collected via [ah-fs](https://github.com/nodesource/ah-fs)
-   `id` **[number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** the id of the root activity we whose triggered _children_ we are trying to find
-   `stop` **[function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** a predicate that will finish the activity walk if it returns `true`.
     Function signature: `(id, activity)`.

Returns **[Set](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set)&lt;[number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)>** the provided root id and all ids of activities triggered by it or any of it's children,
grandchildren, etc.

### utils.prettyNs

Prettifies the provided timestamp which is expected to be in nanoseconds.

**Parameters**

-   `ns` **[number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** timestamp in nanoseconds

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)&lt;[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String), [number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)>** an object with an `ms` property which is the prettified version
of the provided timestamp in milliseconds and `ns`, the originally passed timestamp.

### utils.safeGetVal

Safely extracts the `val` property from the object `x`.

**Parameters**

-   `x` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** the object which has the `val` property

Returns **any** the `val` property if `x` was defined, otherwise `null`

### utils.uniqueUserFunctions

Identifies all user functions within the given functions, adds location and
propertyPath strings and returns the result.

The `propertyPath` is deduced from the `path` array.

If a user function is found twice it will only be included once.

**Parameters**

-   `fns` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** all functions found attached to a particular async resource
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** options
    -   `$0.pathPrefix` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** prefix used for the property paths (optional, default `'root'`)

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** all user functions with the above mentioned details added

## License

MIT
